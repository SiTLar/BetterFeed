!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(1),o=r(a),s=n(3),i=r(s),u=n(4),c=r(u),l=n(5),d=r(l),f=n(7),h=r(f),p=window.parent===window?window.opener:window.parent;p&&/[?&]origin=([^&]+)/.exec(location.search)||alert("Пожалуйста, откройте эту страницу по ссылке из FreeFeed-а");var m=decodeURIComponent(/[?&]origin=([^&]+)/.exec(location.search)[1]);c["default"].then(function(){var e=location.pathname.match(/BetterFeed\/([^\/]+)/),t=document.querySelector(".content.settings"),n=d["default"](t,"input[type='checkbox']"),r=new i["default"],a=null;e&&document.querySelector(".version").appendChild(document.createTextNode(e[1])),d["default"](document.body,".local-link",function(e){return e.href+=location.search}),document.getElementById("check-updates").addEventListener("click",function(e){var t=e.target;t.disabled=!0,r.send(p,m,"checkUpdates").then(function(){return t.disabled=!1})}),document.getElementById("save-settings").addEventListener("click",function(e){var t=e.target;t.disabled=!0,n.forEach(function(e){return a.setFlag(e.value,e.checked)});var o=document.getElementById("ban-list-posts").value.toLowerCase().match(/\w+/g);null===o&&(o=[]),a.banPosts=o,o=document.getElementById("ban-list-comms").value.toLowerCase().match(/\w+/g),null===o&&(o=[]),a.banComms=o,r.send(p,m,"saveSettings",a).then(function(){return t.disabled=!1})}),r.send(p,m,"getSettings").then(function(e){a=new o["default"](void 0,e),n.forEach(function(e){return e.checked=a.flag(e.value)}),document.getElementById("ban-list-posts").value=a.banPosts.join(", "),document.getElementById("ban-list-comms").value=a.banComms.join(", "),d["default"](t,"[data-disabled-if]",function(e){var t=e.dataset.disabledIf,n=document.getElementById(t);n&&h["default"].fromInput(n).onValue(function(t){return e.disabled=t})}),d["default"](t,"[data-enabled-if]",function(e){var t=e.dataset.enabledIf,n=document.getElementById(t);n&&h["default"].fromInput(n).onValue(function(t){return e.disabled=!t})}),t.classList.remove("hidden"),t.previousElementSibling.classList.add("hidden")})})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){try{return JSON.parse(e)}catch(n){return t}}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),i="bfSettings",u=["fix-names","lightboxed-images","bottom-comment-link","colored-comment-icons","at-links","comment-icons-click","animated-gif","where-this-post-from","userpics-in-comments","embed-ly","hide-aliens","hide","user-info","comment-counters","new-lines","fold-texts","direct-style","emoji","not-you","confirm-delete","show-group-admins","docs-preview","hide-repeated-comments-icons","datetime","show-usernames"];t.flagNames=u;var c=["not-you"],l=function(){function e(t,n){if(r(this,e),void 0!==n)this.userId=n.userId,this.flags=n.flags,this.banPosts=n.banPosts,this.banComms=n.banComms,this.hideAlienPosts=n.hideAlienPosts;else if(this.userId=t,!localStorage.hasOwnProperty(i)&&localStorage.hasOwnProperty("ffc-sac-settings"))this.flags=JSON.parse(localStorage["ffc-sac-settings"]),this.banPosts=a(localStorage["be-fe.banList"],[]),this.banComms=a(localStorage["be-fe.banListComms"],[]),this.hideAlienPosts="1"===localStorage["be-fe.hide-alien-posts"],this.save();else{var o=a(localStorage[i],{}),s=o.hasOwnProperty(this.userId)?o[this.userId]:{};this.flags=s.hasOwnProperty("flags")?s.flags:{},this.banPosts=s.hasOwnProperty("banPosts")?s.banPosts:[],this.banComms=s.hasOwnProperty("banComms")?s.banComms:[],this.hideAlienPosts=s.hasOwnProperty("banComms")?!!s.hideAlienPosts:!1}}return o(e,[{key:"flag",value:function(e){return s.arrHas(u,e)?this.flags.hasOwnProperty(e)?this.flags[e]:!s.arrHas(c,e):!1}},{key:"setFlag",value:function(e,t){s.arrHas(u,e)&&(this.flags[e]=!!t)}},{key:"save",value:function(){var e=a(localStorage[i],{});e[this.userId]={flags:this.flags,banPosts:this.banPosts,banComms:this.banComms,hideAlienPosts:this.hideAlienPosts},localStorage[i]=JSON.stringify(e)}}]),e}();t["default"]=l},function(e,t){"use strict";function n(e,t){a(e,t)||e.push(t)}function r(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function a(e,t){return-1!==e.indexOf(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.arrAdd=n,t.arrDel=r,t.arrHas=a},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=1,o="@response",s=function(){function e(){var t=this;n(this,e),this.__responders=new Map,this.__listeners=new Map,window.addEventListener("message",function(e){if("object"==typeof e.data){var n=e.data,r=n.action,a=n.requestId,s=n.value,i=e.source,u=e.origin;if(r===o&&t.__responders.has(a))t.__responders.get(a)(s),t.__responders["delete"](a);else if(t.__listeners.has(r)){var c=t.__listeners.get(r)(s);i.postMessage({action:o,requestId:a,value:c},u)}}})}return r(e,[{key:"send",value:function(e,t,n){var r=this,o=void 0===arguments[3]?null:arguments[3];return new Promise(function(s){var i=a++;r.__responders.set(i,s),e.postMessage({action:n,requestId:i,value:o},t)})}},{key:"on",value:function(e,t){this.__listeners.set(e,t)}}]),e}();t["default"]=s,e.exports=t["default"]},function(e,t){"use strict";e.exports=new Promise(function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,0):document.addEventListener("DOMContentLoaded",e)})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),o=r(a);t["default"]=function(e,t,n){if(null===e)return[];var r=e.querySelectorAll(t),a=r?Array.prototype.slice.call(r):[];if(o["default"](e,t)&&a.unshift(e),n)for(var s=0,i=a.length;i>s;s++)n(a[s]);return a},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="matches"in HTMLElement.prototype?"matches":"msMatchesSelector";t["default"]=function(e,t){return e[n](t)},e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){n(this,e),this._value=t,this._listeners=new Set}return r(e,[{key:"onValue",value:function(e){return this._listeners.add(e),e(this.value),this}},{key:"unListen",value:function(e){return this._listeners["delete"](e),this}},{key:"derive",value:function(t){var n=new e;return this.onValue(function(e){return t(n,e)}),n}},{key:"map",value:function(e){return this.derive(function(t,n){return t.value=e(n)})}},{key:"filter",value:function(e){return this.derive(function(t,n){return e(n)&&(t.value=n)})}},{key:"distinct",value:function(){var e;return this.derive(function(t,n){n!==e&&(e=n,t.value=n)})}},{key:"value",get:function(){return this._value},set:function(e){this._value=e,this._listeners.forEach(function(t){return t(e)})}}],[{key:"combine",value:function(){for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];var a=new e(n.map(function(e){return e.value}));return n.forEach(function(e,t){return e.onValue(function(e){var n=a.value;n[t]=e,a.value=n})}),a}},{key:"fromInput",value:function(t,n,r){if(!t||!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement))return new e(null);var a="value";t instanceof HTMLInputElement&&("checkbox"===t.type||"radio"===t.type)&&(a="checked");var o=n?n.split(" "):["input","change"];r=r||a;var s=function(){return"self"===r?t:t[r]},i=new e(s());return o.forEach(function(e){return t.addEventListener(e,function(){return i.value=s()})}),i}}]),e}();t["default"]=a,e.exports=t["default"]}]);