!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a=n(1),s=r(a),i=n(2),c=r(i),d=n(3),u=r(d),l=n(4),f=r(l),m=window.parent===window?window.opener:window.parent;m&&/[?&]origin=([^&]+)/.exec(location.search)||alert("Пожалуйста, откройте эту страницу по ссылке из FreeFeed-а");var h=decodeURIComponent(/[?&]origin=([^&]+)/.exec(location.search)[1]);u["default"].then(function(){var e=location.pathname.match(/BetterFeed\/([^\/]+)/),t=document.querySelector(".content.settings"),n=f["default"](t,"input[type='checkbox']"),r=new c["default"],a=null;e&&document.querySelector(".version").appendChild(document.createTextNode(e[1])),f["default"](document.body,".local-link",function(e){return e.href+=location.search}),document.getElementById("check-updates").addEventListener("click",function(e){var t=e.target;t.disabled=!0,r.send(m,h,"checkUpdates").then(function(){return t.disabled=!1})}),document.getElementById("save-settings").addEventListener("click",function(e){var t=e.target;t.disabled=!0,n.forEach(function(e){return a.setFlag(e.value,e.checked)});var o=document.getElementById("ban-list-posts").value.toLowerCase().match(/\w+/g);null===o&&(o=[]),a.banPosts=new Set(o),o=document.getElementById("ban-list-comms").value.toLowerCase().match(/\w+/g),null===o&&(o=[]),a.banComms=new Set(o),r.send(m,h,"saveSettings",a).then(function(){return t.disabled=!1})}),r.send(m,h,"getSettings").then(function(e){a=new s["default"](void 0,e),n.forEach(function(e){return e.checked=a.flag(e.value)}),document.getElementById("ban-list-posts").value=[].concat(o(a.banPosts)).join(", "),document.getElementById("ban-list-comms").value=[].concat(o(a.banComms)).join(", "),t.classList.remove("hidden"),t.previousElementSibling.classList.add("hidden")})})},function(e,t){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){try{return JSON.parse(e)}catch(n){return t}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s="bfSettings",i=new Set(["fix-names","lightboxed-images","bottom-comment-link","colored-comment-icons","at-links","comment-icons-click","animated-gif","where-this-post-from","userpics-in-comments","embed-ly","hide-aliens","hide","user-info","comment-counters","new-lines","fold-texts","direct-style","emoji","not-you","confirm-delete","show-group-admins","docs-preview","hide-repeated-comments-icons","datetime","show-usernames"]);t.flagNames=i;var c=new Set(["not-you"]),d=function(){function e(t,n){if(r(this,e),void 0!==n)this.userId=n.userId,this.flags=n.flags,this.banPosts=n.banPosts,this.banComms=n.banComms,this.hideAlienPosts=n.hideAlienPosts;else if(this.userId=t,!localStorage.hasOwnProperty(s)&&localStorage.hasOwnProperty("ffc-sac-settings"))this.flags=JSON.parse(localStorage["ffc-sac-settings"]),this.banPosts=new Set(o(localStorage["be-fe.banList"],[])),this.banComms=new Set(o(localStorage["be-fe.banListComms"],[])),this.hideAlienPosts="1"===localStorage["be-fe.hide-alien-posts"],this.save();else{var a=o(localStorage[s],{}),i=a.hasOwnProperty(this.userId)?a[this.userId]:{};this.flags=i.hasOwnProperty("flags")?i.flags:{},this.banPosts=new Set(i.hasOwnProperty("banPosts")?i.banPosts:[]),this.banComms=new Set(i.hasOwnProperty("banComms")?i.banComms:[]),this.hideAlienPosts=i.hasOwnProperty("banComms")?!!i.hideAlienPosts:!1}}return a(e,[{key:"flag",value:function(e){return i.has(e)?this.flags.hasOwnProperty(e)?this.flags[e]:!c.has(e):!1}},{key:"setFlag",value:function(e,t){i.has(e)&&(this.flags[e]=!!t)}},{key:"save",value:function(){var e=o(localStorage[s],{});e[this.userId]={flags:this.flags,banPosts:[].concat(n(this.banPosts)),banComms:[].concat(n(this.banComms)),hideAlienPosts:this.hideAlienPosts},localStorage[s]=JSON.stringify(e)}}]),e}();t["default"]=d},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=1,a="@response",s=function(){function e(){var t=this;n(this,e),this.__responders=new Map,this.__listeners=new Map,window.addEventListener("message",function(e){if("object"==typeof e.data){var n=e.data,r=n.action,o=n.requestId,s=n.value,i=e.source,c=e.origin;if(r===a&&t.__responders.has(o))t.__responders.get(o)(s);else if(t.__listeners.has(r)){var d=t.__listeners.get(r)(s);i.postMessage({action:a,requestId:o,value:d},c)}}})}return r(e,[{key:"send",value:function(e,t,n){var r=this,a=void 0===arguments[3]?null:arguments[3];return new Promise(function(s){var i=o++;r.__responders.set(i,s),e.postMessage({action:n,requestId:i,value:a},t)})}},{key:"on",value:function(e,t){this.__listeners.set(e,t)}}]),e}();t["default"]=s,e.exports=t["default"]},function(e,t){"use strict";e.exports=new Promise(function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,0):document.addEventListener("DOMContentLoaded",e)})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=r(o);t["default"]=function(e,t,n){if(null===e)return[];var r=e.querySelectorAll(t),o=r?Array.prototype.slice.call(r):[];if(a["default"](e,t)&&o.unshift(e),n)for(var s=0,i=o.length;i>s;s++)n(o[s]);return o},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="matches"in HTMLElement.prototype?"matches":"msMatchesSelector";t["default"]=function(e,t){return e[n](t)},e.exports=t["default"]}]);