!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var o=n(1),a=r(o),s=n(3),i=r(s),c=n(4),u=r(c),d=n(5),l=r(d),f=n(2),m=r(f),p=window.parent===window?window.opener:window.parent;p&&/[?&]origin=([^&]+)/.exec(location.search)||alert("Пожалуйста, откройте эту страницу по ссылке из FreeFeed-а");var h=decodeURIComponent(/[?&]origin=([^&]+)/.exec(location.search)[1]);u["default"].then(function(){var e=location.pathname.match(/BetterFeed\/([^\/]+)/),t=document.querySelector(".content.settings"),n=l["default"](t,"input[type='checkbox']"),r=new i["default"],o=null;e&&document.querySelector(".version").appendChild(document.createTextNode(e[1])),l["default"](document.body,".local-link",function(e){return e.href+=location.search}),document.getElementById("check-updates").addEventListener("click",function(e){var t=e.target;t.disabled=!0,r.send(p,h,"checkUpdates").then(function(){return t.disabled=!1})}),document.getElementById("save-settings").addEventListener("click",function(e){var t=e.target;t.disabled=!0,n.forEach(function(e){return o.setFlag(e.value,e.checked)});var a=document.getElementById("ban-list-posts").value.toLowerCase().match(/\w+/g);null===a&&(a=[]),o.banPosts=new Set(a),a=document.getElementById("ban-list-comms").value.toLowerCase().match(/\w+/g),null===a&&(a=[]),o.banComms=new Set(a),r.send(p,h,"saveSettings",o).then(function(){return t.disabled=!1})}),r.send(p,h,"getSettings").then(function(e){o=new a["default"](void 0,e),n.forEach(function(e){return e.checked=o.flag(e.value)}),document.getElementById("ban-list-posts").value=m["default"](o.banPosts).join(", "),document.getElementById("ban-list-comms").value=m["default"](o.banComms).join(", "),t.classList.remove("hidden"),t.previousElementSibling.classList.add("hidden")})})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){try{return JSON.parse(e)}catch(n){return t}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),c=r(i),u="bfSettings",d=new Set(["fix-names","lightboxed-images","bottom-comment-link","colored-comment-icons","at-links","comment-icons-click","animated-gif","where-this-post-from","userpics-in-comments","embed-ly","hide-aliens","hide","user-info","comment-counters","new-lines","fold-texts","direct-style","emoji","not-you","confirm-delete","show-group-admins","docs-preview","hide-repeated-comments-icons","datetime","show-usernames"]);t.flagNames=d;var l=new Set(["not-you"]),f=function(){function e(t,n){if(o(this,e),void 0!==n)this.userId=n.userId,this.flags=n.flags,this.banPosts=n.banPosts,this.banComms=n.banComms,this.hideAlienPosts=n.hideAlienPosts;else if(this.userId=t,!localStorage.hasOwnProperty(u)&&localStorage.hasOwnProperty("ffc-sac-settings"))this.flags=JSON.parse(localStorage["ffc-sac-settings"]),this.banPosts=new Set(a(localStorage["be-fe.banList"],[])),this.banComms=new Set(a(localStorage["be-fe.banListComms"],[])),this.hideAlienPosts="1"===localStorage["be-fe.hide-alien-posts"],this.save();else{var r=a(localStorage[u],{}),s=r.hasOwnProperty(this.userId)?r[this.userId]:{};this.flags=s.hasOwnProperty("flags")?s.flags:{},this.banPosts=new Set(s.hasOwnProperty("banPosts")?s.banPosts:[]),this.banComms=new Set(s.hasOwnProperty("banComms")?s.banComms:[]),this.hideAlienPosts=s.hasOwnProperty("banComms")?!!s.hideAlienPosts:!1}}return s(e,[{key:"flag",value:function(e){return d.has(e)?this.flags.hasOwnProperty(e)?this.flags[e]:!l.has(e):!1}},{key:"setFlag",value:function(e,t){d.has(e)&&(this.flags[e]=!!t)}},{key:"save",value:function(){var e=a(localStorage[u],{});e[this.userId]={flags:this.flags,banPosts:c["default"](this.banPosts),banComms:c["default"](this.banComms),hideAlienPosts:this.hideAlienPosts},localStorage[u]=JSON.stringify(e)}}]),e}();t["default"]=f},function(e,t){"use strict";function n(e){if(Array.from)return Array.from(e);var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=1,a="@response",s=function(){function e(){var t=this;n(this,e),this.__responders=new Map,this.__listeners=new Map,window.addEventListener("message",function(e){if("object"==typeof e.data){var n=e.data,r=n.action,o=n.requestId,s=n.value,i=e.source,c=e.origin;if(r===a&&t.__responders.has(o))t.__responders.get(o)(s),t.__responders["delete"](o);else if(t.__listeners.has(r)){var u=t.__listeners.get(r)(s);i.postMessage({action:a,requestId:o,value:u},c)}}})}return r(e,[{key:"send",value:function(e,t,n){var r=this,a=void 0===arguments[3]?null:arguments[3];return new Promise(function(s){var i=o++;r.__responders.set(i,s),e.postMessage({action:n,requestId:i,value:a},t)})}},{key:"on",value:function(e,t){this.__listeners.set(e,t)}}]),e}();t["default"]=s,e.exports=t["default"]},function(e,t){"use strict";e.exports=new Promise(function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,0):document.addEventListener("DOMContentLoaded",e)})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=r(o);t["default"]=function(e,t,n){if(null===e)return[];var r=e.querySelectorAll(t),o=r?Array.prototype.slice.call(r):[];if(a["default"](e,t)&&o.unshift(e),n)for(var s=0,i=o.length;i>s;s++)n(o[s]);return o},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="matches"in HTMLElement.prototype?"matches":"msMatchesSelector";t["default"]=function(e,t){return e[n](t)},e.exports=t["default"]}]);